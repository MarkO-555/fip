killall
remount / ro
if [ ! $? = 0 ]
then
   echo Abort: shutdown failed.
   exit 1
fi 
if [ ! -z "$1" ] && [ $1 = "-r" ]
then
   reboot
else
   halt
fi

